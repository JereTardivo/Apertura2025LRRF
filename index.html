<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Fixture Apertura 2025</title>
<style>
  body{font-family:sans-serif;margin:20px;}
  table{border-collapse:collapse;margin-bottom:20px;}
  th,td{border:1px solid #999;padding:4px 8px;text-align:center;}
  th{background:#eee;}
  .fecha{margin-top:20px;}
</style>
</head>
<body>
<h1>Apertura 2025 LRRF</h1>
<div id="fechas"></div>
<h2>Tabla de Posiciones</h2>
<table id="tabla">
  <thead>
    <tr>
      <th>Pos</th><th>Equipo</th><th>Pts</th><th>PJ</th><th>PG</th><th>PE</th><th>PP</th><th>GF</th><th>GC</th><th>DG</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<script>
async function cargar(){
  const resp=await fetch('data.json');
  const data=await resp.json();
  const cont=document.getElementById('fechas');
  data.fechas.forEach(fecha=>{
    const div=document.createElement('div');
    div.className='fecha';
    const h=document.createElement('h2');
    h.textContent='Fecha '+fecha.fecha;
    div.appendChild(h);
    const table=document.createElement('table');
    const tb=document.createElement('tbody');
    fecha.partidos.forEach((p,idx)=>{
      const tr=document.createElement('tr');
      const tdLocal=document.createElement('td');
      tdLocal.textContent=p.local;
      const tdVisit=document.createElement('td');
      tdVisit.textContent=p.visitante;
      const tdRes=document.createElement('td');
      if(fecha.fecha>=14){
        const inpL=document.createElement('input');
        inpL.type='number';
        inpL.min=0;
        inpL.value=p.goles_local??'';
        const inpV=document.createElement('input');
        inpV.type='number';
        inpV.min=0;
        inpV.value=p.goles_visitante??'';
        inpL.addEventListener('input',()=>{p.goles_local=inpL.value!==''?parseInt(inpL.value):null;actualizarTabla();});
        inpV.addEventListener('input',()=>{p.goles_visitante=inpV.value!==''?parseInt(inpV.value):null;actualizarTabla();});
        tdRes.appendChild(inpL);
        tdRes.appendChild(document.createTextNode(' - '));
        tdRes.appendChild(inpV);
      } else {
        tdRes.textContent=p.goles_local+' - '+p.goles_visitante;
      }
      tr.appendChild(tdLocal);
      tr.appendChild(tdRes);
      tr.appendChild(tdVisit);
      tb.appendChild(tr);
    });
    table.appendChild(tb);
    div.appendChild(table);
    cont.appendChild(div);
  });
  window.data=data;
  actualizarTabla();
}

function actualizarTabla(){
  const tabla=computeTabla(window.data.fechas);
  const tbody=document.querySelector('#tabla tbody');
  tbody.innerHTML='';
  tabla.forEach(t=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${t.pos}</td><td>${t.team}</td><td>${t.pts}</td><td>${t.PJ}</td><td>${t.PG}</td><td>${t.PE}</td><td>${t.PP}</td><td>${t.GF}</td><td>${t.GC}</td><td>${t.DG}</td>`;
    tbody.appendChild(tr);
  });
}

function computeTabla(fechas){
  const stats={};
  fechas.forEach(f=>{
    f.partidos.forEach(p=>{
      stats[p.local]=stats[p.local]||{team:p.local,pts:0,PJ:0,PG:0,PE:0,PP:0,GF:0,GC:0};
      stats[p.visitante]=stats[p.visitante]||{team:p.visitante,pts:0,PJ:0,PG:0,PE:0,PP:0,GF:0,GC:0};
      if(p.goles_local==null||p.goles_visitante==null) return;
      const L=stats[p.local], V=stats[p.visitante];
      L.PJ++; V.PJ++;
      L.GF+=p.goles_local; L.GC+=p.goles_visitante;
      V.GF+=p.goles_visitante; V.GC+=p.goles_local;
      if(p.goles_local>p.goles_visitante){L.PG++; L.pts+=3; V.PP++;}
      else if(p.goles_local<p.goles_visitante){V.PG++; V.pts+=3; L.PP++;}
      else{L.PE++; V.PE++; L.pts++; V.pts++;}
    });
  });
  const arr=Object.values(stats).map(s=>{s.DG=s.GF-s.GC;return s;});
  arr.sort((a,b)=>b.pts-a.pts||b.DG-a.DG||b.GF-a.GF||a.team.localeCompare(b.team));
  arr.forEach((s,i)=>s.pos=i+1);
  return arr;
}

cargar();
</script>
</body>
</html>
